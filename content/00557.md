---
title: Kubernetesハンズオン - 7. IngressによるL7ロードバランシング
tags: ["Kubernetes Handson", "Kubernetes", "PKS"]
categories: ["Dev", "CaaS", "Kubernetes"]
updated: 1970-01-01T09:00:00+09:00
---

これまでにServiceによるロードバランシングは見てきましたが、Serviceは現時点ではL4 LoadBalancer相当であり、
HTTPヘッダーなどは考慮されません。TLS TerminationもServiceレベルでは行えないため、Podまたは外部LoadBalancer単位で行う必要があります。

また外部に公開するアプリケーションに対して、`type=LoadBalancer`なServiceを一つ一つ用意すると、Serviceの分だけLoadBalancerのコストがかかります。

![image](https://user-images.githubusercontent.com/106908/39979824-9dd4f640-5783-11e8-98cd-cff838861c05.png)

このような課題に対して、[Ingress](https://kubernetes.io/docs/concepts/services-networking/ingress/)はService前のL7レベル LoadBalancer相当の機能を提供します。

IngressはServiceに対するHost名ベースまたはパスベースのルーティングを提供します。外部LoadBalancerはIngress (Controller)に対してルーティングすれば複数のLoadBalancerを用意する必要はありません。
またTLS Terminationを行うこともできます。

![image](https://user-images.githubusercontent.com/106908/39988628-d408f224-57a2-11e8-91a9-b150232b7d0d.png)

`Ingress`はKubernetesのリソースであり、このリソースを以ってServiceへのルーティングを定義できます。
`Ingree`リソースを使用するにはIngress Controllerを用意することが必要です。Ingress ControllerはPodとしてデプロイ可能です。

Ingress Controller自体はAPI仕様であり、Ingress Controllerの実装としては

* [Nginx](https://kubernetes.github.io/ingress-nginx/)
* [Contour](https://github.com/projectcontour/contour)
* [GCE](https://github.com/kubernetes/ingress-gce)
* [ALB](https://github.com/kubernetes-sigs/aws-alb-ingress-controller)
* [Istio](https://istio.io/docs/tasks/traffic-management/ingress.html)

などが有名です。

本ドキュメントでは環境に依存しないようにNginx Ingress Controllerを使用します。

### TBD
