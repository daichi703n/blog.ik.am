---
title: BOSH Lite + UAA + CredHubをインストールする
tags: ["BOSH", "BOSH-Lite", "UAA", "CredHub"]
categories: ["Dev", "Infrastructure", "BOSH"]
---

[この記事](https://blog.ik.am/entries/428)の延長編。次は[CredHub](https://docs.pivotal.io/pivotalcf/1-11/credhub/)も導入します。

BOSH VMは次のような構成になる。

<img src="https://docs.pivotal.io/pivotalcf/1-11/credhub/images/bosh-deployment.png" />


### BOSH Lite作成

`credhub.yml`も追加する。

```
bosh2 create-env bosh.yml \
  --state ./state.json \
  -o virtualbox/cpi.yml \
  -o virtualbox/outbound-network.yml \
  -o bosh-lite.yml \
  -o bosh-lite-runc.yml \
  -o uaa.yml \
  -o credhub.yml \
  --vars-store ./creds.yml \
  -v director_name="Bosh Lite Director" \
  -v internal_ip=192.168.50.6 \
  -v internal_gw=192.168.50.1 \
  -v internal_cidr=192.168.50.0/24 \
  -v outbound_network_name=NatNetwork
```

### CredHub CLIインストール

```
brew install cloudfoundry/tap/credhub-cli
```

### CredHubログイン

```
bosh2 int ./creds.yml --path /uaa_ssl/ca > ~/uaa_ca
bosh2 int ./creds.yml --path /credhub_ca/ca > ~/credhub_ca
credhub login -s 192.168.50.6:8844 -u credhub-cli -p `bosh2 int ./creds.yml --path /credhub_cli_password` --ca-cert ~/uaa_ca --ca-cert ~/credhub_ca
```

軽くAPIを試す

```
$ credhub generate -n demo-pass -t password
id: 5a5ae163-6f4a-4582-b2cd-560dbb98007a
name: /demo-pass
type: password
value: NvxyWg1vX41G0IQxO3eZJvocVTBQQ6
version_created_at: 2017-07-02T07:18:54Z

$ credhub get -n demo-pass
id: 5a5ae163-6f4a-4582-b2cd-560dbb98007a
name: /demo-pass
type: password
value: NvxyWg1vX41G0IQxO3eZJvocVTBQQ6
version_created_at: 2017-07-02T07:18:54Z

$ credhub delete -n demo-pass
Credential successfully deleted
```
